<script src="/socket.io/socket.io.js"></script>
<script src="js/clientside_groupchat.js"></script>
<script src="js/clientside_notes.js"></script>
<script src="js/clientside_agenda.js"></script>
<script src="js/clientside_qna.js"></script>
<script src="js/script.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code
.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<link rel="stylesheet" type="text/css" href="stylesheets/css/style.css">

<script>
var socket = io.connect('http://localhost:4000');

var newChat = ChatClient();
newChat.init(socket);

var notebook = NoteClient();
notebook.init(socket)

var agenda = AgendaClient();
agenda.init(socket);

var wisdom = {
	global : {
		userid : "123",
		sesssionid: "666"

	}
};

var QnAModule = QnAClient();
QnAModule.initialize(socket,wisdom.global.sessionid,wisdom.global.userid,'kamiller',renderQnA);

	$(function(){
		/**
		var dynamo = function() {
		var windowWidth = $(window).width();
		var leftBarWidth = $('#leftBar').css({'width'});
		var rightBarWidth = $('#rightBar').css({'width'});
		var videoWidth = $('#video').css({'width'});
		if(windowWidth < 1279) {

		};
	};*/
		$('#currentTopic').click( function() {
			if($('#agenda').css('display') === 'none') {
				$('#agenda').css({'display':'block'});
			}
			else {
				$('#agenda').css({'display': 'none'});
			};

		});

		/*$('.agenda-item').click( function() {
			var topicId = this.id;
			alert(topicId);	
			//agenda.changeMainTopic(thisItem);
		});*/

		$('#chat-tab').click( function() {
			if($('#chatroom').css('display') === 'none' ) {
				$('#qa').css({'display':'none'});
				$('#chatroom').css({'display':'block'});
				$('#newquestionbox').css({'display' : 'none'
				});
				$('#submitnewquestion').css({'display' : 'none'
				});

			}
		});

		$('#qa-tab').click( function() {
			if($('#qa').css('display') === 'none') {
				$('#chatroom').css({'display':'none'});
				$('#qa').css({'display':'block'});
				$('#newquestionbox').css({'display' : 'block'
				});
				$('#submitnewquestion').css({'display' : 'block'
				});
			}
		});
		// when the client clicks SEND
		$('#enterchat').click( function() {
			var message = $('#chatdata').val();
			$('#chatdata').val('');
			// tell server to execute 'sendchat' and send along message as parameter
			newChat.sendMessage(message);
		});

		// when the client hits ENTER on their keyboard
		$('#enterchat').keypress(function(e) {
			if(e.which == 13) {
				$(this).blur();
				$('#chatdata').focus().click();
			}
		});

		//send and save notes after 5 second after user stops typing
		//5 second timer doesn't work...
		var stoppedTyping;
		$('#notesarea').keypress(function() {
			var notes = $('#notesarea').val();
			if (stoppedTyping) clearTimeout(stoppedTyping);

			stoppedTyping = setTimeout(notebook.updateNotes(notes), 5000);
		});



	});

	newChat.joinChat = function(chatlog) {
		for(var i = 0; i < chatlog.length; i++) {
			$('#conversation').append('<b>'+ chatlog[i].username + ':</b> ' + chatlog[i].messageData + '<br>');
		}
	};
	newChat.displayChat = function(username, message) {
		$('#conversation').append('<b>'+ username + ':</b> ' + message + '<br>');
	};

	notebook.clientNoteStamp = function() {
		$('#timestamp').text("Saved.");
		setTimeout(function() {
		$('#timestamp').text("Saved less than a minute ago.")
		}, 10000);
		setTimeout(function() {
			$('#timestamp').text("Saved about a minute ago.")
		}, 60000);
		setTimeout(function() {
			$('#timestamp').text("Saved more than 2 minutes ago")
		}, 120000);

	};
	agenda.createAgenda = function(topics) {
		for(var i = 0; i < topics.length; i++) {
			console.log(topics[i]);
			$('#agenda').append("<li id=\'agenda-li" + i + "\'class='agenda-item'></li>");
			$('#agenda-li' + i).append("<div id=\'topic" + i + "\'>" + topics[i] + "<div id=\'switch" + i + "\' class='switch'></div></div");
		}
	};
	agenda.changeTopic = function(topicId) {
		var topic = $(topicId).val();
		$('currentTopic').val(topic);
		$(topicId).css({'background-color':'purple'});

	};

</script>
<html>
	<head>
		<title>Wastewise</title>
	</head>

	<body>
		<div id='header'>
			<h1>WasteWise Roundtable</h1>
		</div>

		<div id='leftBar'>
			<div id='agenda-tab'>
				<span class='tab-text'>Agenda</span>
			</div>

			<div id='thisAgenda'>
				<div id='currentTopic'></div>
			</div>

			<ul id='agenda'></ul>

			<div id='notes-tab'>
				<span id='timestamp'></span>
				<span class='tab-text'>Notes</span>
			</div>

			<div id='notes'>
				<textarea id='notesarea'></textarea>
			</div>
			
		</div>

		<div id='video'>
			<iframe src="//www.youtube.com/embed/RAJgGIQ3JHk" frameborder="0" allowfullscreen></iframe>
		</div>

		<div id='rightBar'>
			<div id='chat-tab'>chat</div>
			<div id='qa-tab'>QA</div>
			<div id='chatroom'>
				<div id='conversation'></div>
				<input id='chatdata' />
				<input id='enterchat' type='button' value='send' />
			</div>
			<div id='qa'>
				<div id="q1"></div>
			<br>
				<h3>Questions</h3>
			<div id="questionDiv"></div>

			<div align="center">
		    <br/>
		    </div>

					</div>
				<input type="text" id="newquestionbox" size="25" value="Enter your Question here!">
		      <br><input type="button" id='submitnewquestion' value="Propose Question" onclick='proposeQuestion();'><br>

				</div>

		</div>

				<div id='timer'>01:59:00</div>

		<div id='participants-tab'>
			<ul>

				<li></li>
				<li></li>
				<li></li>
				<li></li>
				<li></li>
				<li></li>
			</ul>
		</div>
	</body>

</html>
